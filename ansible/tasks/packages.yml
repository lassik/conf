---
- name: Install Homebrew packages
  homebrew: name={{ item }}
  with_dict: "{{ brew_packages | default({}) }}"
  when: ansible_os_family == "Darwin" and "brew" in item.value
  become: no
  tags:
    - pkg
    - brew

- name: Install APT packages
  apt: name={{ item.key }}
  with_dict: "{{ packages | default({}) }}"
  when: ansible_os_family == "Debian" and "apt" in item.value
  become: yes
  tags:
    - pkg
    - apt

- name: Install FreeBSD packages
  pkgng: name={{ item.key }}
  with_dict: "{{ packages | default({}) }}"
  when: ansible_os_family == "FreeBSD" and "freebsd" in item.value
  become: yes
  tags:
    - pkg
    - freebsd

- name: Install NPM packages (for all users)
  npm: name={{ item }} global=yes
  with_dict: "{{ packages | default([]) }}"
  when: '"npm" in item.value'
  become: "{{ ansible_os_family != 'Darwin' }}"
  tags:
    - pkg
    - npm
