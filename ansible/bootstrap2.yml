---
- name: Ensure we can login and sudo then lock down ssh access
  hosts: all
  remote_user: lassi
  become: yes
  tasks:
    - lineinfile: "dest=/etc/ssh/sshd_config regexp='^#?PermitRootLogin' line='PermitRootLogin no'"
    - lineinfile: "dest=/etc/ssh/sshd_config regexp='^#?PasswordAuthentication' line='PasswordAuthentication no'"
    - when: ansible_os_family == "Debian"
      service: name=ssh state=restarted
    - when: ansible_os_family == "RedHat"
      service: name=sshd state=restarted
    - file: path=/root/.ssh/authorized_keys state=absent
